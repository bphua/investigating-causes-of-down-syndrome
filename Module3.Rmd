---
title: "Module 3 Report"
author: '450132759'
date: "October 2, 2018"
output: 
  prettydoc::html_pretty:
    theme: cayman # prettydoc theme
    highlight: null # syntax highlighting
    css: custom.css # custom css file to change font family and size
---
<style>
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono');
@import url('https://fonts.googleapis.com/css?family=Lato');
body{
  font-family: 'Lato' !important;
  font-size: 12pt;
}

code{
  font-family: 'Roboto Mono' !important;
  font-size: 12px;
}

pre{
  font-family: 'Roboto Mono' !important;
  font-size: 12px
}

td{
  font-family: Lato !important;
  font-size: 12pt;
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, fig.align = "center")
```

## Executive summary
## Introduction
## Results
## Conclusion
## Test

## Things to keep in mind
For this module report you will be assessed on your ability to generate appropriate statistical questions, explore these with graphical summaries and statistical tests and interpret your findings. To achieve full marks, your report will also need to be well-presented:

Think about how your report might be structured (e.g. Executive Summary, Introduction, Results, Conclusion).
Do your figures have captions?
Are your figures legible?
Are you using headings and sub-headings effectively in your report?

When running a test,
State the null and alternative hypotheses.
Use visulisation to comment the assumption of the data.
Perform a suitable test (including checking any relevant assumptions and, where appropriate, justify why you chose that test over others that test the same hypothesis).
Report the test statistic and p-value.
Draw your conclusion about the null hypothesis based on the p-value and interpret this in the context of the original question.

## Importing data

```{r import}
library(tidyverse)
library(gridExtra)
data <- read_table("mouse.txt")
```

## Cleaning data
```{r, results='hide'}
data = data %>% mutate(
  sex = if_else(sex == 1, "Male", "Female"),
  DNA = case_when(DNA == 1 ~ "141G6",
                  DNA == 2 ~ "152F7", 
                  DNA == 3 ~ "230E8",
                  DNA == 4 ~ "285E6"),
  cage = factor(cage),
  tg = if_else(tg == 1, "Transgenic", "Non-transgenic")
)

data = data %>% 
  mutate(
    DNAfragment = case_when(
      tg == "Transgenic" ~ DNA,
      TRUE ~ "No trisomy"
    )
  )
# check the numbers match up
data %>% count(DNAfragment)
data %>% group_by(tg, DNA) %>% count()
```

The following things are from the lab components as an idea of what we could be doing:

Explore the data graphically. Is there a difference between the weights of transgenic and nontransgenic mice? Does sex affect this? For which fragment or fragments of the DNA are there differences?

```{r}
# graphical exploration of data
# will first look at transgenic vs non-transgenic weight, and have it spearated by sex. the paper states that there is a weight difference between sex of mice, which is why this differentiation has to be made.
ggplot(data, aes(y = weight, x = DNAfragment, colour = sex)) + 
  geom_boxplot() + theme_bw() + facet_wrap(~sex, ncol = 2)

# what exactly does this actually tell us?
ggplot(data, aes(sample = weight)) + 
  geom_qq() + geom_qq_line() + theme_bw() + facet_wrap(~sex, ncol = 2)

data = data %>% mutate(log_weight=log(weight))
ggplot(data, aes(y = log_weight, x = DNAfragment, colour = sex)) + 
  geom_boxplot() + theme_bw() + facet_wrap(~sex, ncol = 2)

# what exactly does this actually tell us?
ggplot(data, aes(sample = log_weight)) + 
  geom_qq() + geom_qq_line() + theme_bw() + facet_wrap(~sex, ncol = 2)
```

It can be seen that if weight is an indicator for Down syndrome in mice, not all injected DNA fragements can directly be identified to be causing Down syndrome. Some fragments cause higher weight on average, while some even cause lower weight.
To qualify these differences we perform tests for the following hypothesis: H0: mu_none=mu_1=mu_2=mu_3=mu_4 against H1: all averages being statistically different.

Generate appropriate summary statistics (including sample sizes) for various subgroups of your data.

Consider the one-way classification based on DNA fragment. Is the weight of mice between the different DNA fragment groups different? Please state carefully your null hypothesis. Does the conclusion hold if we consider the male and female mice seperately?

```{r}
a2 = aov(weight ~ DNAfragment * sex, data = data)
summary(a2)
library(emmeans)
emmip(a2, DNAfragment ~ sex) + theme_classic()
emmip(a2, sex ~ DNAfragment) + theme_classic()

library(ggfortify)
autoplot(a2, which = c(1, 2)) + theme_classic()



# log version:
a3 = aov(log_weight ~ DNAfragment * sex, data = data)
summary(a3)
library(emmeans)
emmip(a3, DNAfragment ~ sex) + theme_classic()
emmip(a3, sex ~ DNAfragment) + theme_classic()

library(ggfortify)
autoplot(a3, which = c(1, 2)) + theme_classic()
```

It can be seen from the two-way ANOVA, that the interaction between sex and DNA-fragement can't be dropped! Now we need to perform post-hoc operations to determine which ones are significant.

residuals are approximately correct, with a slight skew to below zero, but the normality is less satisfied, with a significant violation as we get to the higher values, with a large number of outliers. The same behaviour could already be seen on the boxplot before

